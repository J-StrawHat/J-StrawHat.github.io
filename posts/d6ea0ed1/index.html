<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Enable Google Page Views | JoyDee's Blog</title><meta name="keywords" content="google analytics"><meta name="author" content="Joy Dee"><meta name="copyright" content="Joy Dee"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="This post is to enable Page Views on the Chirpy theme based blog that you just built. This requires technical knowledge and it’s recommended to keep the google_analytics.pv disabled unless you have a"><meta property="og:type" content="article"><meta property="og:title" content="Enable Google Page Views"><meta property="og:url" content="https://www.joydee.top/posts/d6ea0ed1/index.html"><meta property="og:site_name" content="JoyDee&#39;s Blog"><meta property="og:description" content="This post is to enable Page Views on the Chirpy theme based blog that you just built. This requires technical knowledge and it’s recommended to keep the google_analytics.pv disabled unless you have a"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><meta property="article:published_time" content="2021-01-03T10:32:00.000Z"><meta property="article:modified_time" content="2021-08-02T09:15:05.281Z"><meta property="article:author" content="Joy Dee"><meta property="article:tag" content="google analytics"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://www.joydee.top/posts/d6ea0ed1/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//hm.baidu.com"><meta name="google-site-verification" content="FcqPwEYbr_cknqo4XYD1DIbaczUgJwPf9WVNALOG_rA"><meta name="baidu-site-verification" content="code-BTKhd4k3xT"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?3c4988fb9892b3bebf918781af0b8ace";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-184747878-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-184747878-1")</script><link rel="stylesheet" href="https://fonts.font.im/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:700},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:50,languages:{author:"作者: Joy Dee",link:"链接: ",source:"来源: JoyDee's Blog",info:"本文为作者的原创文章。遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#121212",position:"bottom-left"},source:{jQuery:"https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js",justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js",css:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css"},fancybox:{js:"https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js",css:"https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"}},isPhotoFigcaption:!1,islazyload:!0,isanchor:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Enable Google Page Views",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2021-08-02 17:15:05"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme");"dark"===t?activateDarkMode():"light"===t&&activateLightMode();const o=saveToLocal.get("aside-status");void 0!==o&&("hide"===o?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));GLOBAL_CONFIG_SITE.isHome&&/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/joydee.css"><link rel="stylesheet" href="/css/night-owl.css"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="JoyDee's Blog" type="application/atom+xml"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/my-loading.jpg" data-lazy-src="https://cdn.joydee.cloud/avatar.jpeg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">101</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">112</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">41</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw far fa-calendar-alt"></i> <span>归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tag"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-layer-group"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i> <span>导航</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://music.apple.com/cn/browse"><i class="fa-fw fas fa-music"></i> <span>Apple Music</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://portal.qiniu.com/home"><i class="fa-fw fas fa-images"></i> <span>七牛云图床</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://github.com/DesertsP/Valine-Admin"><i class="fa-fw fas fa-comments"></i> <span>评论后台管理</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user-circle"></i> <span>关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">JoyDee's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw far fa-calendar-alt"></i> <span>归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tag"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-layer-group"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i> <span>导航</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://music.apple.com/cn/browse"><i class="fa-fw fas fa-music"></i> <span>Apple Music</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://portal.qiniu.com/home"><i class="fa-fw fas fa-images"></i> <span>七牛云图床</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://github.com/DesertsP/Valine-Admin"><i class="fa-fw fas fa-comments"></i> <span>评论后台管理</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user-circle"></i> <span>关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="coverdiv"><img id="post-cover" src="/img/my-loading.jpg" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"></div><div id="post-info"><div id="post-categories-container"><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Blogging/">Blogging</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Blogging/Tutorial/">Tutorial</a></span></div><h1 class="post-title">Enable Google Page Views</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-01-03T10:32:00.000Z" title="发表于 2021-01-03 18:32:00">2021-01-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-08-02T09:15:05.281Z" title="更新于 2021-08-02 17:15:05">2021-08-02</time></span><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="fas fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">1.5k</span></span><span class="post-meta-separator">|</span><span data-flag-title="Enable Google Page Views"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="twikoo_visitors"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="fas fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/d6ea0ed1/#post-comment"><span id="twikoo-count"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>This post is to enable Page Views on the <a target="_blank" rel="noopener" href="https://github.com/cotes2020/jekyll-theme-chirpy/"><strong>Chirpy</strong></a> theme based blog that you just built. This requires technical knowledge and it’s recommended to keep the <code>google_analytics.pv</code> disabled unless you have a good reason. If your website has low traffic, the page views count would discourage you to write more blogs. With that said, let’s start with the setup.</p><h2 id="Set-up-Google-Analytics"><a class="header-anchor" href="#Set-up-Google-Analytics">¶</a>Set up Google Analytics</h2><h3 id="Create-GA-account-and-property"><a class="header-anchor" href="#Create-GA-account-and-property">¶</a>Create GA account and property</h3><p>First, you need to setup your account on Google analytics. While your create your account, you must create your first <strong>Property</strong> as well.</p><ol><li>Head to <a target="_blank" rel="noopener" href="https://analytics.google.com/">https://analytics.google.com/</a> and click on <strong>Start Measuring</strong></li><li>Enter your desired <em>Account Name</em> and choose the desired checkboxes</li><li>Enter your desired <em>Property Name</em>. This is the name of the tracker project that appears on your Google Analytics dashboard</li><li>Enter the required information <em>About your business</em></li><li>Hit <em>Create</em> and accept any license popup to setup your Google Analytics account and create your property</li></ol><h3 id="Create-Data-Stream"><a class="header-anchor" href="#Create-Data-Stream">¶</a>Create Data Stream</h3><p>With your property created, you now need to set up Data Stream to track your blog traffic. After you signup, the prompt should automatically take you to creating your first <strong>Data Stream</strong>. If not, follow these steps:</p><ol><li>Go to <strong>Admin</strong> on the left column</li><li>Select the desired property from the drop down on the second column</li><li>Click on <strong>Data Streams</strong></li><li>Add a stream and click on <strong>Web</strong></li><li>Enter your blog’s URL</li></ol><p>It should look like this:</p><p><img src="/img/my-loading.jpg" data-lazy-src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/posts/20210103/01-google-analytics-data-stream.png" alt="google-analytics-data-stream"></p><p>Now, click on the new data stream and grab the <strong>Measurement ID</strong>. It should look something like <code>G-V6XXXXXXXX</code>. Copy this to your <code>_config.yml</code> file</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">google_analytics:</span><br>  <span class="hljs-attr">id:</span> <span class="hljs-string">&#x27;G-V6XXXXXXX&#x27;</span>          <span class="hljs-comment"># Fill with your Google Analytics ID</span><br>  <span class="hljs-attr">pv:</span><br>    <span class="hljs-comment"># The Google Analytics pageviews switch.</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># the next options only valid when `google_analytics.pv` is enabled.</span><br>    <span class="hljs-attr">proxy_url:</span> <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-attr">proxy_endpoint:</span> <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-attr">cache:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment"># pv data local cache, good for the users from GFW area.</span><br></code></pre></td></tr></table></figure><p>When you push these changes to your blog, you should start seeing the traffic on your Google Analytics. Play around with Google Analytics dashboard to get familiar with the options available as it takes like 5 mins to pickup your changes. You should now be able to monitor your traffic in realtime.</p><p><img src="/img/my-loading.jpg" data-lazy-src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/posts/20210103/02-google-analytics-realtime.png" alt="google-analytics-realtime"></p><h2 id="Setup-Page-Views"><a class="header-anchor" href="#Setup-Page-Views">¶</a>Setup Page Views</h2><p>There is a detailed <a target="_blank" rel="noopener" href="https://developers.google.com/analytics/solutions/google-analytics-super-proxy">tutorial</a> available to set up Google Analytics superProxy. But, if you are interested to just quickly get your Chirpy-based blog display page views, follow along. These steps were tested on a Linux machine. If you are running Windows, you can use Git bash terminal to run Unix-like commands.</p><h3 id="Setup-Google-App-Engine"><a class="header-anchor" href="#Setup-Google-App-Engine">¶</a>Setup Google App Engine</h3><ol><li><p>Visit <a target="_blank" rel="noopener" href="https://console.cloud.google.com/appengine">https://console.cloud.google.com/appengine</a></p></li><li><p>Click on <strong>Create Application</strong></p></li><li><p>Click on <strong>Create Project</strong></p></li><li><p>Enter the name and choose the data center close to you</p></li><li><p>Select <strong>Python</strong> language and <strong>Standard</strong> environment</p></li><li><p>Enable billing account. Yeah, you have to link your credit card. But, you won’t be billed unless you exceed your free quota. For a simple blog, free quota is more than sufficient.</p></li><li><p>Go to your App Engine dashboard on your browser and select <strong>API &amp; Services</strong> from the left navigation menu</p></li><li><p>Click on <strong>Enable APIs and Services</strong> button on the top</p></li><li><p>Enable the following APIs: <em>Google Analytics API</em></p></li><li><p>On the left, Click on <em>OAuth Consent Screen</em> and accept <strong>Configure Consent Screen</strong>. Select <strong>External</strong> since your blog is probably hosted for the public. Click on <strong>Publish</strong> under <em>Publishing Status</em></p></li><li><p>Click on <strong>Credentials</strong> on the left and create a new <strong>OAuth Client IDs</strong> credential. Make sure to add a entry under <code>Authorized redirect URIs</code> that matches: <code>https://&lt;project-id&gt;.&lt;region&gt;.r.appspot.com/admin/auth</code></p></li><li><p>Note down the <strong>Your Client ID</strong> and <strong>Your Client Secret</strong>. You’ll need this in the next section.</p></li><li><p>Download and install the cloud SDK for your platform: <a target="_blank" rel="noopener" href="https://cloud.google.com/sdk/docs/quickstart">https://cloud.google.com/sdk/docs/quickstart</a></p></li><li><p>Run the following commands:</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs console">[root@bc96abf71ef8 /]# gcloud init<br><br>~snip~<br><br>Go to the following link in your browser:<br><br>    https://accounts.google.com/o/oauth2/auth?response_type=code&amp;client_id=XYZ.apps.googleusercontent.com&amp;redirect_uri=ABCDEFG<br><br>Enter verification code: &lt;VERIFICATION CODE THAT YOU GET AFTER YOU VISIT AND AUTHENTICATE FROM THE ABOVE LINK&gt;<br><br>You are logged in as: [blah_blah@gmail.com].<br><br>Pick cloud project to use:<br>[1] chirpy-test-300716<br>[2] Create a new project<br>Please enter numeric choice or text value (must exactly match list<br>item): 1<br><br><br>[root@bc96abf71ef8 /]# gcloud info<br><span class="hljs-meta">#</span><span class="bash"> Your selected project info should be displayed here</span><br></code></pre></td></tr></table></figure></li></ol><h3 id="Setup-Google-Analytics-superProxy"><a class="header-anchor" href="#Setup-Google-Analytics-superProxy">¶</a>Setup Google Analytics superProxy</h3><ol><li><p>Clone the <strong>Google Analytics superProxy</strong> project on Github: <a target="_blank" rel="noopener" href="https://github.com/googleanalytics/google-analytics-super-proxy">https://github.com/googleanalytics/google-analytics-super-proxy</a> to your local.</p></li><li><p>Remove the first 2 lines in the <a target="_blank" rel="noopener" href="https://github.com/googleanalytics/google-analytics-super-proxy/blob/master/src/app.yaml#L1-L2"><code>src/app.yaml</code></a> file:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">-application:</span> <span class="hljs-string">your-project-id</span><br><span class="hljs-string">-version:</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li><li><p>In <code>src/config.py</code>, add the <code>OAUTH_CLIENT_ID</code> and <code>OAUTH_CLIENT_SECRET</code> that you gathered from you App Engine Dashboard.</p></li><li><p>Enter any random key for <code>XSRF_KEY</code>, your <code>config.py</code> should look similar to this</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python2.7</span><br><br>__author__ = <span class="hljs-string">&#x27;pete.frisella@gmail.com (Pete Frisella)&#x27;</span><br><br><span class="hljs-comment"># OAuth 2.0 Client Settings</span><br>AUTH_CONFIG = &#123;<br>  <span class="hljs-string">&#x27;OAUTH_CLIENT_ID&#x27;</span>: <span class="hljs-string">&#x27;YOUR_CLIENT_ID&#x27;</span>,<br>  <span class="hljs-string">&#x27;OAUTH_CLIENT_SECRET&#x27;</span>: <span class="hljs-string">&#x27;YOUR_CLIENT_SECRET&#x27;</span>,<br>  <span class="hljs-string">&#x27;OAUTH_REDIRECT_URI&#x27;</span>: <span class="hljs-string">&#x27;%s%s&#x27;</span> % (<br>    <span class="hljs-string">&#x27;https://chirpy-test-XXXXXX.ue.r.appspot.com&#x27;</span>,<br>    <span class="hljs-string">&#x27;/admin/auth&#x27;</span><br>  )<br>&#125;<br><br><span class="hljs-comment"># XSRF Settings</span><br>XSRF_KEY = <span class="hljs-string">&#x27;OnceUponATimeThereLivedALegend&#x27;</span><br></code></pre></td></tr></table></figure><p><strong>Tip:</strong> You can configure a custom domain instead of <code>https://PROJECT_ID.REGION_ID.r.appspot.com</code>. But, for the sake of keeping it simple, we will be using the Google provided default URL.</p></li><li><p>From inside the src/ directory, deploy the app</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs console">[root@bc96abf71ef8 src]# gcloud app deploy<br>Services to deploy:<br><br>descriptor:      [/tmp/google-analytics-super-proxy/src/app.yaml]<br>source:          [/tmp/google-analytics-super-proxy/src]<br>target project:  [chirpy-test-XXXX]<br>target service:  [default]<br>target version:  [VESRION_NUM]<br>target url:      [https://chirpy-test-XXXX.ue.r.appspot.com]<br><br><br>Do you want to continue (Y/n)? Y<br><br>Beginning deployment of service [default]...<br>╔════════════════════════════════════════════════════════════╗<br>╠═ Uploading 1 file to Google Cloud Storage                 ═╣<br>╚════════════════════════════════════════════════════════════╝<br>File upload done.<br>Updating service [default]...done.<br>Setting traffic split for service [default]...done.<br>Deployed service [default] to [https://chirpy-test-XXXX.ue.r.appspot.com]<br><br>You can stream logs from the command line by running:<br><span class="hljs-meta">$</span><span class="bash"> gcloud app logs tail -s default</span><br><br>To view your application in the web browser run:<br><span class="hljs-meta">$</span><span class="bash"> gcloud app browse</span><br></code></pre></td></tr></table></figure></li><li><p>Visit the deployed service. Add a <code>/admin</code> to the end of the URL.</p></li><li><p>Click on <strong>Authorize Users</strong> and make sure to add yourself as a managed user.</p></li><li><p>If you get any errors, please Google it. The errors are self-explanatory and should be easy to fix.</p></li></ol><p>If everything went good, you’ll get this screen:</p><p><img src="/img/my-loading.jpg" data-lazy-src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/posts/20210103/03-superProxy-deployed.png" alt="superProxy-deployed"></p><h3 id="Create-Google-Analytics-Query"><a class="header-anchor" href="#Create-Google-Analytics-Query">¶</a>Create Google Analytics Query</h3><p>Head to <code>https://PROJECT_ID.REGION_ID.r.appspot.com/admin</code> and create a query after verifying the account. <strong>GA Core Reporting API</strong> query request can be created in <a target="_blank" rel="noopener" href="https://ga-dev-tools.appspot.com/query-explorer/">Query Explorer</a>.</p><p>The query parameters are as follows:</p><ul><li><strong>start-date</strong>: fill in the first day of blog posting</li><li><strong>end-date</strong>: fill in <code>today</code> (this is a parameter supported by GA Report, which means that it will always end according to the current query date)</li><li><strong>metrics</strong>: select <code>ga:pageviews</code></li><li><strong>dimensions</strong>: select <code>ga:pagePath</code></li></ul><p>In order to reduce the returned results and reduce the network bandwidth, we add custom filtering rules [^ga-filters]:</p><ul><li><p><strong>filters</strong>: fill in <code>ga:pagePath=~^/posts/.*/$;ga:pagePath!@=</code>.</p><p>Among them, <code>;</code> means using <em>logical AND</em> to concatenate two rules.</p><p>If the <code>site.baseurl</code> is specified, change the first filtering rule to <code>ga:pagePath=~^/BASE_URL/posts/.*/$</code>, where <code>BASE_URL</code> is the value of <code>site.baseurl</code>.</p></li></ul><p>After <kbd>Run Query</kbd>, copy the generated contents of <strong>API Query URI</strong> at the bottom of the page, and fill in the <strong>Encoded URI for the query</strong> of SuperProxy on GAE.</p><p>After the query is saved on GAE, a <strong>Public Endpoint</strong> (public access address) will be generated, and we will get the query result in JSON format when accessing it. Finally, click <kbd>Enable Endpoint</kbd> in <strong>Public Request Endpoint</strong> to make the query effective, and click <kbd>Start Scheduling</kbd> in <strong>Scheduling</strong> to start the scheduled task.</p><p><img src="/img/my-loading.jpg" data-lazy-src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/posts/20210103/04-superproxy-query.png" alt="superproxy-query"></p><h2 id="Configure-Chirpy-to-Display-Page-View"><a class="header-anchor" href="#Configure-Chirpy-to-Display-Page-View">¶</a>Configure Chirpy to Display Page View</h2><p>Once all the hard part is done, it is very easy to enable the Page View on Chirpy theme. Your superProxy dashboard should look something like below and you can grab the required values.</p><p><img src="/img/my-loading.jpg" data-lazy-src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/posts/20210103/05-superproxy-dashboard.png" alt="superproxy-dashboard"></p><p>Update the <code>_config.yml</code> file of <a target="_blank" rel="noopener" href="https://github.com/cotes2020/jekyll-theme-chirpy/"><strong>Chirpy</strong></a> project with the values from your dashboard, to look similar to the following:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">google_analytics:</span><br>  <span class="hljs-attr">id:</span> <span class="hljs-string">&#x27;G-XXXXXXXXXX&#x27;</span>   <span class="hljs-comment"># Fill with your Google Analytics ID</span><br>  <span class="hljs-attr">pv:</span><br>    <span class="hljs-comment"># The Google Analytics pageviews switch.</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-comment"># the next options only valid when `google_analytics.pv` is enabled.</span><br>    <span class="hljs-attr">proxy_url:</span> <span class="hljs-string">&#x27;https://PROJECT_ID.REGION_ID.r.appspot.com&#x27;</span><br>    <span class="hljs-attr">proxy_endpoint:</span> <span class="hljs-string">&#x27;https://PROJECT_ID.REGION_ID.r.appspot.com/query?id=&lt;ID FROM SUPER PROXY&gt;&#x27;</span><br>    <span class="hljs-attr">cache:</span> <span class="hljs-literal">false</span>      <span class="hljs-comment"># pv data local cache, good for the users from GFW area.</span><br></code></pre></td></tr></table></figure><p>Now, you should see the Page View enabled on your blog.</p><h2 id="Reference"><a class="header-anchor" href="#Reference">¶</a>Reference</h2><p>[^ga-filters]: <a target="_blank" rel="noopener" href="https://developers.google.com/analytics/devguides/reporting/core/v3/reference#filters">Google Analytics Core Reporting API: Filters</a></p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="mailto:undefined">Joy Dee</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://www.joydee.top/posts/d6ea0ed1/">https://www.joydee.top/posts/d6ea0ed1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.joydee.top" target="_blank">JoyDee's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/google-analytics/">google analytics</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 不妨请我一杯咖啡？</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn.joydee.cloud/alipay.png" target="_blank"><img class="post-qr-code-img" src="/img/my-loading.jpg" data-lazy-src="https://cdn.joydee.cloud/alipay.png" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/e6f39a62/"><img class="prev-cover" src="/img/my-loading.jpg" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">电基&amp;模电简答题复习</div></div></a></div><div class="next-post pull-right"><a href="/posts/384b5203/"><img class="next-cover" src="/img/my-loading.jpg" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">「汇编学习记录03」实验大作业-数值运算与数据输出</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/my-loading.jpg" data-lazy-src="https://cdn.joydee.cloud/avatar.jpeg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">Joy Dee</div><div class="author-info__description">Cause I have a dream.</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">101</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">112</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">41</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/J-StrawHat"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/J-StrawHat" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:422148166@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://leetcode-cn.com/u/j_strawhat-2/" target="_blank" title="LeetCode"><i class="fas fa-code"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-box-open"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Set-up-Google-Analytics"><span class="toc-text">Set up Google Analytics</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-GA-account-and-property"><span class="toc-text">Create GA account and property</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-Data-Stream"><span class="toc-text">Create Data Stream</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Setup-Page-Views"><span class="toc-text">Setup Page Views</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Setup-Google-App-Engine"><span class="toc-text">Setup Google App Engine</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Setup-Google-Analytics-superProxy"><span class="toc-text">Setup Google Analytics superProxy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-Google-Analytics-Query"><span class="toc-text">Create Google Analytics Query</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configure-Chirpy-to-Display-Page-View"><span class="toc-text">Configure Chirpy to Display Page View</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-text">Reference</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-car"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/9e115195/" title="计算机网络错题汇总"><img src="/img/my-loading.jpg" data-lazy-src="https://gitee.com/j__strawhat/MyImages/raw/master/jisuanjiwangluo.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="计算机网络错题汇总"></a><div class="content"><a class="title" href="/posts/9e115195/" title="计算机网络错题汇总">计算机网络错题汇总</a><time datetime="2021-06-18T13:00:00.000Z" title="发表于 2021-06-18 21:00:00">2021-06-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/67a91b71/" title="「数电实验课程设计4」可控进制的计数器"><img src="/img/my-loading.jpg" data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="「数电实验课程设计4」可控进制的计数器"></a><div class="content"><a class="title" href="/posts/67a91b71/" title="「数电实验课程设计4」可控进制的计数器">「数电实验课程设计4」可控进制的计数器</a><time datetime="2021-06-16T16:57:53.000Z" title="发表于 2021-06-17 00:57:53">2021-06-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/290ad7f9/" title="马原考点总结"><img src="/img/my-loading.jpg" data-lazy-src="https://gitee.com/j__strawhat/MyImages/raw/master/marxismbanner.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="马原考点总结"></a><div class="content"><a class="title" href="/posts/290ad7f9/" title="马原考点总结">马原考点总结</a><time datetime="2021-06-13T09:00:00.000Z" title="发表于 2021-06-13 17:00:00">2021-06-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/da2a8f19/" title="「数据库系统概论」问答题总结"><img src="/img/my-loading.jpg" data-lazy-src="https://gitee.com/j__strawhat/MyImages/raw/master/shujukuxitonggailun.jpeg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="「数据库系统概论」问答题总结"></a><div class="content"><a class="title" href="/posts/da2a8f19/" title="「数据库系统概论」问答题总结">「数据库系统概论」问答题总结</a><time datetime="2021-06-10T11:47:53.000Z" title="发表于 2021-06-10 19:47:53">2021-06-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/83a0adbc/" title="「JavaSE学习笔记10」Java 易错归纳"><img src="/img/my-loading.jpg" data-lazy-src="https://gitee.com/j__strawhat/MyImages/raw/master/rc24-java-25yrs.gif" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="「JavaSE学习笔记10」Java 易错归纳"></a><div class="content"><a class="title" href="/posts/83a0adbc/" title="「JavaSE学习笔记10」Java 易错归纳">「JavaSE学习笔记10」Java 易错归纳</a><time datetime="2021-06-06T05:04:00.000Z" title="发表于 2021-06-06 13:04:00">2021-06-06</time></div></div></div></div></div></div></main><footer id="footer" style="background:#393d49"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Joy Dee</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hope you learn something in my blog and leave your comment!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论区"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div></div><hr><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{const t=document.getElementById("twikoo-count"),e=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo-comment-849gi7rry-j-strawhat.vercel.app/",region:"",katex:{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1}},null))},o=()=>{twikoo.getCommentsCount({envId:"https://twikoo-comment-849gi7rry-j-strawhat.vercel.app/",region:"",urls:[window.location.pathname],includeReply:!1}).then((function(e){t.innerText=e[0].count})).catch((function(t){console.error(t)}))},i=(i=!1)=>{"object"==typeof twikoo?(e(),i&&t&&setTimeout(o,0)):getScript("https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js").then(()=>{e(),i&&t&&setTimeout(o,0)})};i(!0)})()</script></div></div></body></html>